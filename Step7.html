<!-- Step 7: Monte Carlo Simulation (Buy vs Mine) - Parameter-Based -->

<div class="info-box">
    <div class="info-box-title">Monte Carlo Simulation Framework</div>
    <div class="info-box-text">
        This simulation generates <strong>thousands of scenarios</strong> based on your target prices and volatility expectations to compare:
        <strong>Buy BTC Today</strong> vs <strong>Invest in Mining</strong>. Simply state where you think BTC and hash prices will be in 5 years, and see which strategy wins more often across different possible futures.
    </div>
</div>

<div class="controls">
    <h3>Step 7: Monte Carlo Simulation</h3>
    
    <!-- SIMULATION PARAMETERS -->
    <div style="background: #e8f4fd; border: 2px solid #3498db; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #2c3e50;">Simulation Parameters</h4>
        
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
            <div>
                <label for="numSimulations" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                    Number of Simulations:
                </label>
                <input type="number" id="numSimulations" value="1000" step="100" min="100" max="10000" 
                       style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px;">
                <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                    More simulations = more accurate results (1000-5000 recommended)
                </small>
            </div>
            
            <div>
                <label for="projectionYears" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                    Projection Years:
                </label>
                <input type="number" id="projectionYears" value="5" step="1" min="1" max="10" 
                       style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px;">
                <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                    Time horizon for projections (typically 5 years)
                </small>
            </div>
        </div>
    </div>
    
    <!-- BTC PRICE PARAMETERS -->
    <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #856404;">Bitcoin Price Parameters</h4>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
            <div>
                <label for="btcStartPrice" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                    Starting BTC Price ($):
                </label>
                <input type="number" id="btcStartPrice" value="100000" step="1000" min="10000" 
                       style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px;">
                <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                    Current BTC price (Year 0)
                </small>
            </div>
            
            <div>
                <label for="btcTargetPrice" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                    Target BTC Price at Year 5 ($):
                </label>
                <input type="number" id="btcTargetPrice" value="300000" step="10000" min="10000" 
                       style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px;">
                <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                    Expected BTC price at end of projection
                </small>
            </div>
            
            <div>
                <label for="btcVolatility" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                    Annual Volatility (%):
                </label>
                <input type="number" id="btcVolatility" value="60" step="5" min="10" max="200" 
                       style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px;">
                <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                    Price uncertainty (historical BTC ~60-80%)
                </small>
            </div>
        </div>
        
        <div style="margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 4px; font-size: 11px; color: #495057;">
            <strong>Example:</strong> $100k to $300k in 5 years = 24.6% annual return (3x growth). 
            The simulation will generate paths that reach your target price on average, with some paths going higher and some lower based on volatility.
        </div>
    </div>
    
    <!-- HASH PRICE PARAMETERS -->
    <div style="background: #d4edda; border: 2px solid #2d6a4f; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #155724;">Hash Price Parameters (Optional)</h4>
        
        <div style="padding: 15px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 4px; margin-bottom: 15px;">
            <strong>NOTE:</strong> Hash price inputs are NOT used for mining ROI calculation. Mining ROI is calculated using:
            <ul style="margin: 8px 0 0 20px; font-size: 11px;">
                <li>BTC mined based on your network share</li>
                <li>Converted to dollars at Year 5 BTC price</li>
                <li>Same calculation as Step 6 (Investor Analysis)</li>
            </ul>
            These fields are kept for reference only.
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
            <div>
                <label for="hashStartPrice" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                    Starting Hash Price ($/PH/day):
                </label>
                <input type="number" id="hashStartPrice" value="50" step="1" min="1" disabled
                       style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px; background: #f8f9fa;">
                <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                    Reference only (not used in calculation)
                </small>
            </div>
            
            <div>
                <label for="hashTargetPrice" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                    Target Hash Price at Year 5 ($/PH/day):
                </label>
                <input type="number" id="hashTargetPrice" value="50" step="1" min="1" disabled
                       style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px; background: #f8f9fa;">
                <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                    Reference only (not used in calculation)
                </small>
            </div>
            
            <div>
                <label for="hashVolatility" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                    Annual Volatility (%):
                </label>
                <input type="number" id="hashVolatility" value="40" step="5" min="10" max="150" disabled
                       style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px; background: #f8f9fa;">
                <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                    Reference only (not used in calculation)
                </small>
            </div>
        </div>
        
        <div style="margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 4px; font-size: 11px; color: #495057;">
            <strong>How Mining ROI is Calculated:</strong> The simulation uses the same method as Step 6:
            <br>1. Calculate BTC mined based on your hashrate and network difficulty
            <br>2. Apply GP/LP profit sharing from Step 5
            <br>3. Convert BTC to dollars at Year 5 BTC price
            <br>4. Add equipment residual value
            <br>5. Subtract OPEX and initial investment
            <br><strong>Result: Mining ROI will match Step 6 when using median BTC price!</strong>
        </div>
    </div>
    
    <!-- INVESTMENT AMOUNT -->
    <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #2c3e50;">Investment Amount</h4>
        
        <div>
            <label for="investorCapitalMC" style="display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px;">
                Capital to Invest ($):
            </label>
            <input type="number" id="investorCapitalMC" value="200000" step="10000" min="10000" 
                   style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px;">
            <small style="display: block; margin-top: 3px; font-size: 10px; color: #6c757d;">
                Your total investment amount (from Step 5 Investor Analysis)
            </small>
        </div>
    </div>
    
    <button onclick="runMonteCarloSimulation()" class="btn-success" style="width: 100%; padding: 12px; font-size: 13px; font-weight: 600;">
        RUN MONTE CARLO SIMULATION
    </button>
</div>

<!-- RESULTS SECTION (Initially Hidden) -->
<div id="mcResults" style="display: none;">
    
    <!-- HERO COMPARISON -->
    <div class="section-title">MONTE CARLO RESULTS: BUY vs MINE</div>
    
    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border: 2px solid #dee2e6; border-radius: 8px; padding: 30px; margin-bottom: 30px;">
        <h3 style="text-align: center; font-size: 16px; font-weight: 600; color: #2c3e50; margin: 0 0 25px 0;">
            SIMULATION SUMMARY (<span id="simRunCount">0</span> scenarios analyzed)
        </h3>
        
        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center;">
            <!-- Buy Strategy Stats -->
            <div style="background: #fff3cd; border: 3px solid #ffc107; border-radius: 8px; padding: 25px; text-align: center;">
                <div style="font-size: 13px; font-weight: 600; color: #856404; margin-bottom: 15px; text-transform: uppercase;">
                    BUY BTC STRATEGY
                </div>
                <div style="background: white; padding: 15px; border-radius: 4px; margin-bottom: 10px;">
                    <div style="font-size: 10px; color: #6c757d; margin-bottom: 4px;">MEDIAN ROI (P50)</div>
                    <div style="font-size: 28px; font-weight: 700; color: #f39c12;" id="buyMedianROI">0%</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="background: white; padding: 10px; border-radius: 4px;">
                        <div style="font-size: 9px; color: #6c757d; margin-bottom: 3px;">P10 (Bear)</div>
                        <div style="font-size: 16px; font-weight: 600;" id="buyP10">0%</div>
                    </div>
                    <div style="background: white; padding: 10px; border-radius: 4px;">
                        <div style="font-size: 9px; color: #6c757d; margin-bottom: 3px;">P90 (Bull)</div>
                        <div style="font-size: 16px; font-weight: 600;" id="buyP90">0%</div>
                    </div>
                </div>
            </div>

            <!-- VS Divider -->
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: 700; color: #adb5bd;">VS</div>
            </div>

            <!-- Mine Strategy Stats -->
            <div style="background: #d4edda; border: 3px solid #2d6a4f; border-radius: 8px; padding: 25px; text-align: center;">
                <div style="font-size: 13px; font-weight: 600; color: #155724; margin-bottom: 15px; text-transform: uppercase;">
                    MINING STRATEGY
                </div>
                <div style="background: white; padding: 15px; border-radius: 4px; margin-bottom: 10px;">
                    <div style="font-size: 10px; color: #6c757d; margin-bottom: 4px;">MEDIAN ROI (P50)</div>
                    <div style="font-size: 28px; font-weight: 700; color: #2d6a4f;" id="mineMedianROI">0%</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="background: white; padding: 10px; border-radius: 4px;">
                        <div style="font-size: 9px; color: #6c757d; margin-bottom: 3px;">P10 (Bear)</div>
                        <div style="font-size: 16px; font-weight: 600;" id="mineP10">0%</div>
                    </div>
                    <div style="background: white; padding: 10px; border-radius: 4px;">
                        <div style="font-size: 9px; color: #6c757d; margin-bottom: 3px;">P90 (Bull)</div>
                        <div style="font-size: 16px; font-weight: 600;" id="mineP90">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Winner Banner -->
        <div id="mcWinnerBanner" style="margin-top: 25px; padding: 20px; border-radius: 8px; text-align: center; background: #f8f9fa; border: 2px solid #dee2e6;">
            <div style="font-size: 14px; font-weight: 600; color: #6c757d; margin-bottom: 8px;">SIMULATION WINNER</div>
            <div style="font-size: 24px; font-weight: 700; color: #2c3e50;" id="mcWinnerText">-</div>
            <div style="font-size: 12px; color: #6c757d; margin-top: 8px;" id="mcWinnerStats">-</div>
        </div>
    </div>

    <!-- DISTRIBUTION CHARTS - SPLIT VIEW -->
    <div class="section-title">ROI DISTRIBUTION ANALYSIS</div>
    
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
        <!-- Buy BTC Distribution -->
        <div style="background: #fff9e6; border: 2px solid #f39c12; border-radius: 8px; padding: 20px;">
            <div style="text-align: center; margin-bottom: 15px;">
                <div style="font-size: 14px; font-weight: 700; color: #856404; text-transform: uppercase; letter-spacing: 0.5px;">
                    Buy BTC Strategy
                </div>
                <div style="font-size: 10px; color: #6c757d; margin-top: 4px;">
                    Direct Bitcoin Purchase ROI Distribution
                </div>
            </div>
            <canvas id="buyDistributionChart" style="max-height: 350px;"></canvas>
        </div>
        
        <!-- Mine BTC Distribution -->
        <div style="background: #e8f5e9; border: 2px solid #2d6a4f; border-radius: 8px; padding: 20px;">
            <div style="text-align: center; margin-bottom: 15px;">
                <div style="font-size: 14px; font-weight: 700; color: #155724; text-transform: uppercase; letter-spacing: 0.5px;">
                    Mine BTC Strategy
                </div>
                <div style="font-size: 10px; color: #6c757d; margin-top: 4px;">
                    Mining Investment ROI Distribution
                </div>
            </div>
            <canvas id="mineDistributionChart" style="max-height: 350px;"></canvas>
        </div>
    </div>

    <!-- PERCENTILE TABLE -->
    <div class="section-title">DETAILED PERCENTILE ANALYSIS</div>
    
    <table id="percentileTable">
        <thead>
            <tr>
                <th>Percentile</th>
                <th class="number">Buy ROI</th>
                <th class="number">Mine ROI</th>
                <th class="number">Difference</th>
                <th>Winner</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>P10 (Bear Case)</strong></td>
                <td class="number" id="detailBuyP10">-</td>
                <td class="number" id="detailMineP10">-</td>
                <td class="number" id="detailDiffP10">-</td>
                <td id="detailWinnerP10">-</td>
            </tr>
            <tr>
                <td><strong>P25 (Lower Quartile)</strong></td>
                <td class="number" id="detailBuyP25">-</td>
                <td class="number" id="detailMineP25">-</td>
                <td class="number" id="detailDiffP25">-</td>
                <td id="detailWinnerP25">-</td>
            </tr>
            <tr class="highlight-row">
                <td><strong>P50 (Median)</strong></td>
                <td class="number" id="detailBuyP50">-</td>
                <td class="number" id="detailMineP50">-</td>
                <td class="number" id="detailDiffP50">-</td>
                <td id="detailWinnerP50">-</td>
            </tr>
            <tr>
                <td><strong>P75 (Upper Quartile)</strong></td>
                <td class="number" id="detailBuyP75">-</td>
                <td class="number" id="detailMineP75">-</td>
                <td class="number" id="detailDiffP75">-</td>
                <td id="detailWinnerP75">-</td>
            </tr>
            <tr>
                <td><strong>P90 (Bull Case)</strong></td>
                <td class="number" id="detailBuyP90">-</td>
                <td class="number" id="detailMineP90">-</td>
                <td class="number" id="detailDiffP90">-</td>
                <td id="detailWinnerP90">-</td>
            </tr>
        </tbody>
    </table>

    <!-- RISK METRICS -->
    <div class="section-title">RISK & RETURN METRICS</div>
    
    <div class="metrics-grid-4">
        <div class="metric-card">
            <div class="metric-label">Buy Strategy Win Rate</div>
            <div class="metric-value" id="buyWinRate">0%</div>
            <div class="metric-subtext">% of scenarios where Buy wins</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Mine Strategy Win Rate</div>
            <div class="metric-value" id="mineWinRate">0%</div>
            <div class="metric-subtext">% of scenarios where Mine wins</div>
        </div>
        <div class="metric-card warning">
            <div class="metric-label">Buy Downside Risk</div>
            <div class="metric-value" id="buyDownside">0%</div>
            <div class="metric-subtext">% of scenarios with negative ROI</div>
        </div>
        <div class="metric-card warning">
            <div class="metric-label">Mine Downside Risk</div>
            <div class="metric-value" id="mineDownside">0%</div>
            <div class="metric-subtext">% of scenarios with negative ROI</div>
        </div>
    </div>

    <!-- STATISTICAL SUMMARY -->
    <div class="section-title">STATISTICAL SUMMARY</div>
    
    <table id="statsTable">
        <thead>
            <tr>
                <th>Metric</th>
                <th class="number">Buy BTC</th>
                <th class="number">Mine BTC</th>
                <th class="number">Difference</th>
                <th>Interpretation</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Mean ROI</strong></td>
                <td class="number" id="statBuyMean">-</td>
                <td class="number" id="statMineMean">-</td>
                <td class="number" id="statDiffMean">-</td>
                <td id="statInterpMean">-</td>
            </tr>
            <tr>
                <td><strong>Std Deviation</strong></td>
                <td class="number" id="statBuyStd">-</td>
                <td class="number" id="statMineStd">-</td>
                <td class="number" id="statDiffStd">-</td>
                <td id="statInterpStd">-</td>
            </tr>
            <tr>
                <td><strong>Min ROI</strong></td>
                <td class="number" id="statBuyMin">-</td>
                <td class="number" id="statMineMin">-</td>
                <td class="number" id="statDiffMin">-</td>
                <td id="statInterpMin">-</td>
            </tr>
            <tr>
                <td><strong>Max ROI</strong></td>
                <td class="number" id="statBuyMax">-</td>
                <td class="number" id="statMineMax">-</td>
                <td class="number" id="statDiffMax">-</td>
                <td id="statInterpMax">-</td>
            </tr>
        </tbody>
    </table>

    <!-- RECOMMENDATION -->
    <div class="section-title">MONTE CARLO RECOMMENDATION</div>
    
    <div id="mcRecommendationBox" style="padding: 25px; border-radius: 8px; margin-bottom: 25px;">
        <div id="mcRecommendationText" style="font-size: 13px; line-height: 1.6;">
            <p style="margin: 0;">Run simulation to see recommendation</p>
        </div>
    </div>

    <!-- EXPORT -->
    <div style="display: flex; gap: 15px; margin-top: 30px;">
        <button onclick="exportMCReport()" class="btn-success" style="flex: 1;">
            Export Monte Carlo Report (PDF)
        </button>
        <button onclick="exportMCData()" class="btn-primary" style="flex: 1;">
            Export Simulation Data (CSV)
        </button>
    </div>
</div>

<!-- INSTRUCTIONS WHEN NO RESULTS -->
<div id="mcInstructions" style="padding: 30px; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; text-align: center;">
    <div style="font-size: 48px; margin-bottom: 15px;"></div>
    <h3 style="font-size: 16px; color: #2c3e50; margin-bottom: 10px;">Ready to Run Monte Carlo Simulation</h3>
    <p style="font-size: 12px; color: #6c757d; margin: 0 0 20px 0; max-width: 600px; margin-left: auto; margin-right: auto; line-height: 1.6;">
        Set your target BTC and hash prices for Year 5, along with your volatility expectations, 
        choose how many simulations to run, and click "Run Monte Carlo Simulation" to compare Buy vs Mine strategies 
        across thousands of possible futures.
    </p>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 800px; margin: 0 auto;">
        <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
            <div style="font-size: 32px; margin-bottom: 10px;"></div>
            <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px;">Set Targets</div>
            <div style="font-size: 10px; color: #6c757d;">Where will prices be in 5 years?</div>
        </div>
        <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
            <div style="font-size: 32px; margin-bottom: 10px;"></div>
            <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px;">Generate Scenarios</div>
            <div style="font-size: 10px; color: #6c757d;">Monte Carlo simulation</div>
        </div>
        <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
            <div style="font-size: 32px; margin-bottom: 10px;"></div>
            <div style="font-size: 11px; font-weight: 600; margin-bottom: 5px;">View Results</div>
            <div style="font-size: 10px; color: #6c757d;">Distribution analysis</div>
        </div>
    </div>
</div>
