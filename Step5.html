<!-- Step 5: Financial Model & Proforma Projections -->

<div class="info-box">
    <div class="info-box-title">Pro Forma Financial Analysis</div>
    <div class="info-box-text">
        This section provides <strong>industry-standard financial projections</strong> including 5-year Income Statement, Cash Flow Analysis, 
        and key investment metrics. All projections are based on your CAPEX, OPEX, and operational parameters from previous steps.
    </div>
</div>

<div class="controls">
    <h3>Step 5: Investment Structure & Financial Projections</h3>
    
    <!-- PROJECT SUMMARY -->
    <div style="background: #e8f4fd; border: 2px solid #3498db; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #2c3e50;">Project Summary</h4>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
            <div>
                <label style="display: block; font-size: 10px; color: #6c757d; margin-bottom: 4px;">Total CAPEX</label>
                <div style="font-size: 18px; font-weight: 700; color: #2c3e50;">$<span id="savedCapex5">0</span></div>
            </div>
            <div>
                <label style="display: block; font-size: 10px; color: #6c757d; margin-bottom: 4px;">Annual OPEX</label>
                <div style="font-size: 18px; font-weight: 700; color: #2c3e50;">$<span id="savedOpex5">0</span></div>
            </div>
            <div>
                <label style="display: block; font-size: 10px; color: #6c757d; margin-bottom: 4px;">Total Hashrate</label>
                <div style="font-size: 18px; font-weight: 700; color: #2c3e50;"><span id="savedHashrate5">0</span></div>
            </div>
        </div>
    </div>
    
    <!-- BTC PRICE PROJECTION INPUTS -->
    <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #856404;">Bitcoin Price Projections (5-Year)</h4>
        
        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px;">
            <div class="input-group">
                <label for="btcPrice">Current BTC Price ($)</label>
                <input type="number" id="btcPrice" value="100000" step="1000" min="10000" 
                       onchange="calculateInvestmentReturns()" style="width: 100%;">
                <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                    Today's price
                </small>
            </div>
            
            <div class="input-group">
                <label for="btcPriceY1">Year 1 ($)</label>
                <input type="number" id="btcPriceY1" value="110000" step="1000" min="10000" 
                       onchange="calculateInvestmentReturns()" style="width: 100%;">
                <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                    Y1 projection
                </small>
            </div>
            
            <div class="input-group">
                <label for="btcPriceY2">Year 2 ($)</label>
                <input type="number" id="btcPriceY2" value="120000" step="1000" min="10000" 
                       onchange="calculateInvestmentReturns()" style="width: 100%;">
                <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                    Y2 projection
                </small>
            </div>
            
            <div class="input-group">
                <label for="btcPriceY3">Year 3 ($)</label>
                <input type="number" id="btcPriceY3" value="130000" step="1000" min="10000" 
                       onchange="calculateInvestmentReturns()" style="width: 100%;">
                <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                    Y3 projection
                </small>
            </div>
            
            <div class="input-group">
                <label for="btcPriceY4">Year 4 ($)</label>
                <input type="number" id="btcPriceY4" value="140000" step="1000" min="10000" 
                       onchange="calculateInvestmentReturns()" style="width: 100%;">
                <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                    Y4 projection
                </small>
            </div>
            
            <div class="input-group">
                <label for="btcPriceY5">Year 5 ($)</label>
                <input type="number" id="btcPriceY5" value="150000" step="1000" min="10000" 
                       onchange="calculateInvestmentReturns()" style="width: 100%;">
                <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                    Y5 projection
                </small>
            </div>
        </div>
        
        <div style="margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 4px; font-size: 11px; color: #495057;">
            <strong>Tip:</strong> Adjust these prices to model different BTC appreciation scenarios. 
            These projections directly impact revenue calculations in the pro forma statements below.
        </div>
    </div>
    
    <!-- INVESTMENT STRUCTURE INPUTS -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
        <div class="input-group">
            <label for="investorCapital">Your Investment ($)</label>
            <input type="number" id="investorCapital" value="200000" step="10000" min="0" 
                   onchange="calculateInvestmentReturns()" style="width: 100%;">
            <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                Your capital contribution
            </small>
        </div>
        
        <div class="input-group">
            <label for="totalLpCapital">Total LP Capital ($)</label>
            <input type="number" id="totalLpCapital" value="1000000" step="10000" min="0" 
                   onchange="calculateInvestmentReturns()" style="width: 100%;">
            <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                Total Limited Partner capital
            </small>
        </div>
        
        <div class="input-group">
            <label for="gpLpSplit">GP/LP Profit Split</label>
            <select id="gpLpSplit" onchange="calculateInvestmentReturns()" style="width: 100%; padding: 8px;">
                <option value="20-80">20% GP / 80% LP</option>
                <option value="30-70">30% GP / 70% LP</option>
                <option value="40-60" selected>40% GP / 60% LP</option>
                <option value="50-50">50% GP / 50% GP</option>
            </select>
            <small style="display: block; margin-top: 3px; font-size: 9px; color: #6c757d;">
                Profit sharing structure
            </small>
        </div>
    </div>
    
    <button onclick="calculateInvestmentReturns()" class="btn-primary">Calculate Financial Projections</button>
</div>

<!-- ========================================= -->
<!-- BTC DISTRIBUTION STRATEGY -->
<!-- ========================================= -->
<div style="background: #f0f8ff; border: 2px solid #3498db; border-radius: 8px; padding: 20px; margin: 20px 0;">
    <h4 style="margin: 0 0 10px 0; font-size: 16px; color: #2c3e50; display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 20px;">‚öôÔ∏è</span> BTC DISTRIBUTION STRATEGY
    </h4>
    <p style="margin: 0 0 15px 0; font-size: 11px; color: #495057;">
        Define how mined Bitcoin will be allocated annually. Operations need cash for OPEX while maximizing accumulation for exit.
    </p>

    <!-- PRESET TEMPLATES -->
    <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 8px; font-size: 11px; font-weight: 600; color: #2c3e50;">
            Quick Presets:
        </label>
        <div style="display: flex; gap: 10px;">
            <button onclick="applyDistributionPreset('conservative')"
                    style="flex: 1; padding: 8px; border: 2px solid #6c757d; background: white; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">
                üîµ Conservative
                <div style="font-size: 9px; font-weight: normal; color: #6c757d; margin-top: 2px;">40% Sell | 36% LP | 24% GP</div>
            </button>
            <button onclick="applyDistributionPreset('balanced')"
                    style="flex: 1; padding: 8px; border: 2px solid #3498db; background: #e3f2fd; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">
                üü° Balanced (Default)
                <div style="font-size: 9px; font-weight: normal; color: #6c757d; margin-top: 2px;">30% Sell | 42% LP | 28% GP</div>
            </button>
            <button onclick="applyDistributionPreset('aggressive')"
                    style="flex: 1; padding: 8px; border: 2px solid #6c757d; background: white; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">
                üü¢ Aggressive
                <div style="font-size: 9px; font-weight: normal; color: #6c757d; margin-top: 2px;">20% Sell | 48% LP | 32% GP</div>
            </button>
        </div>
    </div>

    <!-- DISTRIBUTION SLIDERS -->
    <div style="background: white; border: 1px solid #dee2e6; border-radius: 6px; padding: 15px; margin-bottom: 15px;">
        <div style="margin-bottom: 12px;">
            <label for="btcSellPercent" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <span style="font-size: 11px; font-weight: 600; color: #e74c3c;">üî¥ Sell for OPEX:</span>
                <span id="btcSellPercentDisplay" style="font-size: 14px; font-weight: 700; color: #e74c3c;">30%</span>
            </label>
            <input type="range" id="btcSellPercent" min="0" max="100" value="30" step="1"
                   oninput="updateDistributionDisplay(); calculateInvestmentReturns();"
                   style="width: 100%; height: 8px; border-radius: 5px; background: linear-gradient(to right, #e74c3c 0%, #e74c3c 30%, #ddd 30%, #ddd 100%);">
        </div>

        <div style="margin-bottom: 12px;">
            <label for="btcLpPercent" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <span style="font-size: 11px; font-weight: 600; color: #3498db;">üîµ LP Accumulation:</span>
                <span id="btcLpPercentDisplay" style="font-size: 14px; font-weight: 700; color: #3498db;">42%</span>
            </label>
            <input type="range" id="btcLpPercent" min="0" max="100" value="42" step="1"
                   oninput="updateDistributionDisplay(); calculateInvestmentReturns();"
                   style="width: 100%; height: 8px; border-radius: 5px; background: linear-gradient(to right, #3498db 0%, #3498db 42%, #ddd 42%, #ddd 100%);">
        </div>

        <div style="margin-bottom: 12px;">
            <label for="btcGpPercent" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <span style="font-size: 11px; font-weight: 600; color: #2d6a4f;">üü¢ GP Accumulation:</span>
                <span id="btcGpPercentDisplay" style="font-size: 14px; font-weight: 700; color: #2d6a4f;">28%</span>
            </label>
            <input type="range" id="btcGpPercent" min="0" max="100" value="28" step="1"
                   oninput="updateDistributionDisplay(); calculateInvestmentReturns();"
                   style="width: 100%; height: 8px; border-radius: 5px; background: linear-gradient(to right, #2d6a4f 0%, #2d6a4f 28%, #ddd 28%, #ddd 100%);">
        </div>

        <!-- Total Validation -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 4px; border: 1px solid #dee2e6;">
            <span style="font-size: 12px; font-weight: 600; color: #495057;">Total Allocation:</span>
            <span id="distributionTotal" style="font-size: 16px; font-weight: 700; color: #2d6a4f;">100%</span>
        </div>
        <div id="distributionWarning" style="display: none; margin-top: 8px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 10px; color: #856404;">
            ‚ö†Ô∏è Total must equal 100%. Please adjust percentages.
        </div>
    </div>

    <!-- SMART TOOLS -->
    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
        <button onclick="calculateMinimumOpexPercent()"
                style="flex: 1; padding: 10px; border: 1px solid #3498db; background: white; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; color: #3498db;">
            üîç Calculate Minimum OPEX %
        </button>
        <label style="display: flex; align-items: center; gap: 8px; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px; cursor: pointer;">
            <input type="checkbox" id="showPresentValue" onchange="calculateInvestmentReturns();">
            <span style="font-size: 11px; font-weight: 600;">Show Present Value (PV)</span>
        </label>
    </div>

    <!-- 5-YEAR IMPACT SUMMARY -->
    <div id="distributionSummary" style="background: white; border: 2px solid #3498db; border-radius: 6px; padding: 15px;">
        <h5 style="margin: 0 0 10px 0; font-size: 12px; font-weight: 700; color: #2c3e50;">üìä 5-Year Impact Summary</h5>
        <div style="font-size: 10px; color: #6c757d; margin-bottom: 10px;">
            Total BTC Mined: <strong id="summaryTotalBtc">0 BTC</strong> over 5 years
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
            <!-- Sold for OPEX -->
            <div style="padding: 10px; background: #fff5f5; border: 1px solid #e74c3c; border-radius: 4px;">
                <div style="font-size: 9px; color: #e74c3c; font-weight: 600; margin-bottom: 5px;">üî¥ SOLD FOR OPEX</div>
                <div style="font-size: 11px; font-weight: 700; color: #2c3e50;" id="summarySoldBtc">0 BTC</div>
                <div style="font-size: 10px; color: #495057; margin-top: 3px;" id="summarySoldValue">$0M</div>
                <div style="font-size: 9px; color: #6c757d; margin-top: 3px;" id="summarySoldPv"></div>
            </div>

            <!-- LP Accumulated -->
            <div style="padding: 10px; background: #f0f8ff; border: 1px solid #3498db; border-radius: 4px;">
                <div style="font-size: 9px; color: #3498db; font-weight: 600; margin-bottom: 5px;">üîµ LP ACCUMULATED</div>
                <div style="font-size: 11px; font-weight: 700; color: #2c3e50;" id="summaryLpBtc">0 BTC</div>
                <div style="font-size: 10px; color: #495057; margin-top: 3px;" id="summaryLpValue">$0M</div>
                <div style="font-size: 9px; color: #6c757d; margin-top: 3px;" id="summaryLpRoi">ROI: 0%</div>
            </div>

            <!-- GP Accumulated -->
            <div style="padding: 10px; background: #f0fff4; border: 1px solid #2d6a4f; border-radius: 4px;">
                <div style="font-size: 9px; color: #2d6a4f; font-weight: 600; margin-bottom: 5px;">üü¢ GP ACCUMULATED</div>
                <div style="font-size: 11px; font-weight: 700; color: #2c3e50;" id="summaryGpBtc">0 BTC</div>
                <div style="font-size: 10px; color: #495057; margin-top: 3px;" id="summaryGpValue">$0M</div>
                <div style="font-size: 9px; color: #6c757d; margin-top: 3px;" id="summaryGpRoi">ROI: 0%</div>
            </div>
        </div>

        <!-- OPEX Coverage Status -->
        <div id="opexCoverageStatus" style="margin-top: 10px; padding: 10px; border-radius: 4px; font-size: 10px;">
            <!-- Populated by JavaScript -->
        </div>
    </div>
</div>

<!-- ========================================= -->
<!-- BTC ACCUMULATION & EXIT SCENARIOS -->
<!-- ========================================= -->
<div class="section-title">BTC ACCUMULATION & EXIT SCENARIOS</div>

<table id="accumulationTable">
    <thead>
        <tr>
            <th>Line Item</th>
            <th class="number">Year 1</th>
            <th class="number">Year 2</th>
            <th class="number">Year 3</th>
            <th class="number">Year 4</th>
            <th class="number">Year 5</th>
        </tr>
    </thead>
    <tbody>
        <tr style="background: #e8f4fd;">
            <td><strong>BTC Mined (This Year)</strong></td>
            <td class="number" id="btc_y1">0</td>
            <td class="number" id="btc_y2">0</td>
            <td class="number" id="btc_y3">0</td>
            <td class="number" id="btc_y4">0</td>
            <td class="number" id="btc_y5">0</td>
        </tr>
        <tr style="background: #fff5f5;">
            <td style="padding-left: 20px; font-size: 10px;">‚îú‚îÄ üî¥ Sold for OPEX</td>
            <td class="number" id="btc_sold_y1" style="font-size: 10px; color: #e74c3c;">0</td>
            <td class="number" id="btc_sold_y2" style="font-size: 10px; color: #e74c3c;">0</td>
            <td class="number" id="btc_sold_y3" style="font-size: 10px; color: #e74c3c;">0</td>
            <td class="number" id="btc_sold_y4" style="font-size: 10px; color: #e74c3c;">0</td>
            <td class="number" id="btc_sold_y5" style="font-size: 10px; color: #e74c3c;">0</td>
        </tr>
        <tr style="background: #f0fff4;">
            <td style="padding-left: 20px; font-size: 10px;">‚îú‚îÄ üü¢ GP Accumulated</td>
            <td class="number" id="btc_gp_y1" style="font-size: 10px; color: #2d6a4f;">0</td>
            <td class="number" id="btc_gp_y2" style="font-size: 10px; color: #2d6a4f;">0</td>
            <td class="number" id="btc_gp_y3" style="font-size: 10px; color: #2d6a4f;">0</td>
            <td class="number" id="btc_gp_y4" style="font-size: 10px; color: #2d6a4f;">0</td>
            <td class="number" id="btc_gp_y5" style="font-size: 10px; color: #2d6a4f;">0</td>
        </tr>
        <tr style="background: #f0f8ff;">
            <td style="padding-left: 20px; font-size: 10px;">‚îî‚îÄ üîµ LP Accumulated</td>
            <td class="number" id="btc_lp_y1" style="font-size: 10px; color: #3498db;">0</td>
            <td class="number" id="btc_lp_y2" style="font-size: 10px; color: #3498db;">0</td>
            <td class="number" id="btc_lp_y3" style="font-size: 10px; color: #3498db;">0</td>
            <td class="number" id="btc_lp_y4" style="font-size: 10px; color: #3498db;">0</td>
            <td class="number" id="btc_lp_y5" style="font-size: 10px; color: #3498db;">0</td>
        </tr>
        <tr style="background: #d4edda; font-weight: 600;">
            <td><strong>Cumulative GP Holdings</strong></td>
            <td class="number" id="cum_gp_y1" style="color: #2d6a4f;">0 BTC</td>
            <td class="number" id="cum_gp_y2" style="color: #2d6a4f;">0 BTC</td>
            <td class="number" id="cum_gp_y3" style="color: #2d6a4f;">0 BTC</td>
            <td class="number" id="cum_gp_y4" style="color: #2d6a4f;">0 BTC</td>
            <td class="number" id="cum_gp_y5" style="color: #2d6a4f;">0 BTC</td>
        </tr>
        <tr style="background: #d4edda; font-weight: 600;">
            <td><strong>Cumulative LP Holdings</strong></td>
            <td class="number" id="cum_lp_y1" style="color: #3498db;">0 BTC</td>
            <td class="number" id="cum_lp_y2" style="color: #3498db;">0 BTC</td>
            <td class="number" id="cum_lp_y3" style="color: #3498db;">0 BTC</td>
            <td class="number" id="cum_lp_y4" style="color: #3498db;">0 BTC</td>
            <td class="number" id="cum_lp_y5" style="color: #3498db;">0 BTC</td>
        </tr>
        <tr style="background: #e8f4fd; font-weight: 600;">
            <td><strong>Total BTC Sold (Cumulative)</strong></td>
            <td class="number" id="cum_sold_y1" style="color: #e74c3c;">0 BTC</td>
            <td class="number" id="cum_sold_y2" style="color: #e74c3c;">0 BTC</td>
            <td class="number" id="cum_sold_y3" style="color: #e74c3c;">0 BTC</td>
            <td class="number" id="cum_sold_y4" style="color: #e74c3c;">0 BTC</td>
            <td class="number" id="cum_sold_y5" style="color: #e74c3c;">0 BTC</td>
        </tr>
        <tr>
            <td style="padding-left: 20px;">BTC Price (End of Year)</td>
            <td class="number" id="price_y1">$0</td>
            <td class="number" id="price_y2">$0</td>
            <td class="number" id="price_y3">$0</td>
            <td class="number" id="price_y4">$0</td>
            <td class="number" id="price_y5">$0</td>
        </tr>
        <tr style="background: #f8f9fa;">
            <td colspan="6" style="text-align: center; font-weight: 600; padding: 8px; font-size: 11px; color: #2c3e50;">
                OPEX COVERAGE CHECK
            </td>
        </tr>
        <tr>
            <td style="font-size: 10px;">OPEX Required (with inflation)</td>
            <td class="number" id="opex_req_y1" style="font-size: 10px;">$0</td>
            <td class="number" id="opex_req_y2" style="font-size: 10px;">$0</td>
            <td class="number" id="opex_req_y3" style="font-size: 10px;">$0</td>
            <td class="number" id="opex_req_y4" style="font-size: 10px;">$0</td>
            <td class="number" id="opex_req_y5" style="font-size: 10px;">$0</td>
        </tr>
        <tr>
            <td style="font-size: 10px;">BTC Sale Proceeds</td>
            <td class="number" id="opex_proceeds_y1" style="font-size: 10px;">$0</td>
            <td class="number" id="opex_proceeds_y2" style="font-size: 10px;">$0</td>
            <td class="number" id="opex_proceeds_y3" style="font-size: 10px;">$0</td>
            <td class="number" id="opex_proceeds_y4" style="font-size: 10px;">$0</td>
            <td class="number" id="opex_proceeds_y5" style="font-size: 10px;">$0</td>
        </tr>
        <tr style="background: #e8f5e9;">
            <td style="font-size: 10px; font-weight: 600;">Coverage Status</td>
            <td class="number" id="opex_status_y1" style="font-size: 10px; font-weight: 600;">-</td>
            <td class="number" id="opex_status_y2" style="font-size: 10px; font-weight: 600;">-</td>
            <td class="number" id="opex_status_y3" style="font-size: 10px; font-weight: 600;">-</td>
            <td class="number" id="opex_status_y4" style="font-size: 10px; font-weight: 600;">-</td>
            <td class="number" id="opex_status_y5" style="font-size: 10px; font-weight: 600;">-</td>
        </tr>
        <tr style="background: #f8f9fa;">
            <td colspan="6" style="text-align: center; font-weight: 600; padding: 12px; font-size: 12px; color: #2c3e50;">
                EXIT SCENARIO ANALYSIS (If You Sell All Accumulated BTC & Exit At End of Each Year)
            </td>
        </tr>
        <tr style="background: #d4edda;">
            <td><strong>Total BTC Sale Proceeds</strong></td>
            <td class="number positive" id="exit_proceeds_y1">$0</td>
            <td class="number positive" id="exit_proceeds_y2">$0</td>
            <td class="number positive" id="exit_proceeds_y3">$0</td>
            <td class="number positive" id="exit_proceeds_y4">$0</td>
            <td class="number positive" id="exit_proceeds_y5">$0</td>
        </tr>
        <tr style="background: #fff3cd;">
            <td><strong>Less: Cumulative OPEX Paid</strong></td>
            <td class="number negative" id="exit_opex_y1">($0)</td>
            <td class="number negative" id="exit_opex_y2">($0)</td>
            <td class="number negative" id="exit_opex_y3">($0)</td>
            <td class="number negative" id="exit_opex_y4">($0)</td>
            <td class="number negative" id="exit_opex_y5">($0)</td>
        </tr>
        <tr style="background: #fef2f2;">
            <td><strong>Less: Initial CAPEX</strong></td>
            <td class="number negative" id="exit_capex_y1">($0)</td>
            <td class="number negative" id="exit_capex_y2">($0)</td>
            <td class="number negative" id="exit_capex_y3">($0)</td>
            <td class="number negative" id="exit_capex_y4">($0)</td>
            <td class="number negative" id="exit_capex_y5">($0)</td>
        </tr>
        <tr style="background: #e8f5e9;">
            <td><strong>Plus: Equipment Residual Value</strong></td>
            <td class="number" id="exit_residual_y1">$0</td>
            <td class="number" id="exit_residual_y2">$0</td>
            <td class="number" id="exit_residual_y3">$0</td>
            <td class="number" id="exit_residual_y4">$0</td>
            <td class="number positive" id="exit_residual_y5">$0</td>
        </tr>
        <tr class="total-row">
            <td><strong>= NET CASH (If Exit This Year)</strong></td>
            <td class="number" id="exit_net_y1">$0</td>
            <td class="number" id="exit_net_y2">$0</td>
            <td class="number" id="exit_net_y3">$0</td>
            <td class="number" id="exit_net_y4">$0</td>
            <td class="number" id="exit_net_y5">$0</td>
        </tr>
        <tr class="highlight-row">
            <td><strong>ROI % (If Exit This Year)</strong></td>
            <td class="number" id="exit_roi_y1">0%</td>
            <td class="number" id="exit_roi_y2">0%</td>
            <td class="number" id="exit_roi_y3">0%</td>
            <td class="number" id="exit_roi_y4">0%</td>
            <td class="number" id="exit_roi_y5">0%</td>
        </tr>
    </tbody>
</table>

<div style="margin-top: 15px; padding: 15px; background: #e8f4fd; border: 2px solid #3498db; border-radius: 8px; font-size: 11px;">
    <strong>How to Read This Table:</strong> Each column shows what happens if you mine until the end of that year,
    then sell all accumulated BTC and exit the project. Green cells = profit, Red cells = loss.
    This helps you decide the optimal exit timing based on BTC price appreciation vs mining difficulty increases.
</div>

<!-- ========================================= -->
<!-- ACCUMULATION PERFORMANCE CHARTS -->
<!-- ========================================= -->
<div class="section-title">BTC ACCUMULATION PERFORMANCE CHARTS</div>

<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
    <!-- BTC Position Value -->
    <div style="background: white; border: 2px solid #f39c12; border-radius: 8px; padding: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 13px; color: #2c3e50; text-align: center; font-weight: 600;">
            Cumulative BTC Position Value
        </h4>
        <canvas id="btcPositionChart" style="max-height: 300px;"></canvas>
    </div>

    <!-- OPEX Breakdown Over Time -->
    <div style="background: white; border: 2px solid #e74c3c; border-radius: 8px; padding: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 13px; color: #2c3e50; text-align: center; font-weight: 600;">
            OPEX Breakdown by Year
        </h4>
        <canvas id="opexBreakdownChart" style="max-height: 300px;"></canvas>
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
    <!-- Cumulative Cash Flow -->
    <div style="background: white; border: 2px solid #2d6a4f; border-radius: 8px; padding: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 13px; color: #2c3e50; text-align: center; font-weight: 600;">
            Cumulative Cash Flow
        </h4>
        <canvas id="cumulativeCashFlowChart" style="max-height: 300px;"></canvas>
    </div>

    <!-- Exit ROI by Year -->
    <div style="background: white; border: 2px solid #9b59b6; border-radius: 8px; padding: 20px;">
        <h4 style="margin: 0 0 15px 0; font-size: 13px; color: #2c3e50; text-align: center; font-weight: 600;">
            Exit ROI % by Year
        </h4>
        <canvas id="exitROIChart" style="max-height: 300px;"></canvas>
    </div>
</div>

<!-- ========================================= -->
<!-- KEY FINANCIAL METRICS DASHBOARD -->
<!-- ========================================= -->
<div class="section-title">KEY INVESTMENT METRICS</div>

<div class="metrics-grid-4" style="margin-bottom: 30px;">
    <div class="metric-card">
        <div class="metric-label">5-Year IRR</div>
        <div class="metric-value" id="metric_irr">0%</div>
        <div class="metric-subtext">Internal Rate of Return</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-label">Project NPV</div>
        <div class="metric-value" id="metric_npv">$0</div>
        <div class="metric-subtext">@ 15% discount rate</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-label">Payback Period</div>
        <div class="metric-value" id="metric_payback">0.0 yrs</div>
        <div class="metric-subtext">Time to recover CAPEX</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-label">Total ROI</div>
        <div class="metric-value" id="metric_roi">0%</div>
        <div class="metric-subtext">5-year return on investment</div>
    </div>
</div>

<!-- ========================================= -->
<!-- INVESTMENT STRUCTURE & RETURNS -->
<!-- ========================================= -->
<div class="section-title">INVESTMENT STRUCTURE & PARTNER RETURNS</div>

<div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
    <h4 style="margin: 0 0 15px 0; font-size: 13px; color: #2c3e50;">Capital Structure</h4>
    <table>
        <thead>
            <tr>
                <th>Partner</th>
                <th class="number">Capital</th>
                <th class="number">% of Total</th>
                <th class="number">Profit Share</th>
            </tr>
        </thead>
        <tbody id="investmentStructureTable">
            <tr><td colspan="4">Calculate to view structure</td></tr>
        </tbody>
    </table>
</div>

<!-- LP Returns Section -->
<div class="section-title">LIMITED PARTNER (LP) RETURNS</div>
<div class="metrics-grid-3">
    <div class="metric-card">
        <div class="metric-label">Your Investment</div>
        <div class="metric-value" id="lpInvestment">$0</div>
        <div class="metric-subtext">Initial capital</div>
    </div>
    <div class="metric-card">
        <div class="metric-label">5-Year Return</div>
        <div class="metric-value positive" id="lpReturn">$0</div>
        <div class="metric-subtext">Net profit after 5 years</div>
    </div>
    <div class="metric-card">
        <div class="metric-label">LP ROI</div>
        <div class="metric-value positive" id="lpROI">0%</div>
        <div class="metric-subtext">Return on investment</div>
    </div>
</div>

<!-- LP Cash Flow Table -->
<div style="margin-top: 20px;">
    <table id="lpCashFlowTable">
        <thead>
            <tr>
                <th>Year</th>
                <th class="number">EBITDA Share</th>
                <th class="number">OPEX Share</th>
                <th class="number">Net Cash Flow</th>
                <th class="number">Cumulative</th>
            </tr>
        </thead>
        <tbody id="lpCashFlowBody">
            <tr><td colspan="5">Calculate to view LP cash flows</td></tr>
        </tbody>
    </table>
</div>

<!-- GP Returns Section -->
<div class="section-title">GENERAL PARTNER (GP) RETURNS</div>
<div class="metrics-grid-3">
    <div class="metric-card">
        <div class="metric-label">GP Share</div>
        <div class="metric-value" id="gpShare">0%</div>
        <div class="metric-subtext">Profit sharing %</div>
    </div>
    <div class="metric-card">
        <div class="metric-label">5-Year Profit</div>
        <div class="metric-value positive" id="gpProfit">$0</div>
        <div class="metric-subtext">Total GP earnings</div>
    </div>
    <div class="metric-card">
        <div class="metric-label">GP/LP Ratio</div>
        <div class="metric-value" id="gpLpRatio">0:0</div>
        <div class="metric-subtext">Profit split ratio</div>
    </div>
</div>

<!-- ========================================= -->
<!-- SENSITIVITY ANALYSIS -->
<!-- ========================================= -->
<div class="section-title">SENSITIVITY ANALYSIS: IRR BY BTC PRICE & HASH RATE</div>

<table id="sensitivityTable">
    <thead>
        <tr>
            <th>BTC Price ‚Üì / Hash Rate ‚Üí</th>
            <th class="number">Base (100%)</th>
            <th class="number">+20%</th>
            <th class="number">+50%</th>
            <th class="number">-20%</th>
            <th class="number">-50%</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>$150,000</strong></td>
            <td class="number" id="sens_150_100">0%</td>
            <td class="number" id="sens_150_120">0%</td>
            <td class="number" id="sens_150_150">0%</td>
            <td class="number" id="sens_150_80">0%</td>
            <td class="number" id="sens_150_50">0%</td>
        </tr>
        <tr class="highlight-row">
            <td><strong>$120,000 (Base)</strong></td>
            <td class="number" id="sens_120_100">0%</td>
            <td class="number" id="sens_120_120">0%</td>
            <td class="number" id="sens_120_150">0%</td>
            <td class="number" id="sens_120_80">0%</td>
            <td class="number" id="sens_120_50">0%</td>
        </tr>
        <tr>
            <td><strong>$100,000</strong></td>
            <td class="number" id="sens_100_100">0%</td>
            <td class="number" id="sens_100_120">0%</td>
            <td class="number" id="sens_100_150">0%</td>
            <td class="number" id="sens_100_80">0%</td>
            <td class="number" id="sens_100_50">0%</td>
        </tr>
        <tr>
            <td><strong>$80,000</strong></td>
            <td class="number" id="sens_80_100">0%</td>
            <td class="number" id="sens_80_120">0%</td>
            <td class="number" id="sens_80_150">0%</td>
            <td class="number" id="sens_80_80">0%</td>
            <td class="number" id="sens_80_50">0%</td>
        </tr>
        <tr>
            <td><strong>$60,000</strong></td>
            <td class="number" id="sens_60_100">0%</td>
            <td class="number" id="sens_60_120">0%</td>
            <td class="number" id="sens_60_150">0%</td>
            <td class="number" id="sens_60_80">0%</td>
            <td class="number" id="sens_60_50">0%</td>
        </tr>
    </tbody>
</table>

<div style="margin-top: 10px; padding: 12px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 11px;">
    <strong>Reading the Table:</strong> Green cells indicate positive IRR, red cells indicate negative IRR. 
    The table shows how project returns change with different BTC prices and hash rate efficiency scenarios.
</div>

<!-- ========================================= -->
<!-- WATERFALL VISUALIZATION -->
<!-- ========================================= -->
<div class="section-title">CASH FLOW WATERFALL</div>

<div id="waterfallContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 25px; margin-bottom: 30px;">
    <canvas id="waterfallChart" style="max-height: 400px;"></canvas>
</div>

<!-- Navigation Buttons -->
<div style="display: flex; gap: 15px; margin-top: 30px;">
    <button onclick="switchStep(4)" class="btn-secondary" style="flex: 1;">
        ‚Üê Back to OPEX
    </button>
    <button onclick="switchStep(6)" class="btn-primary" style="flex: 1;">
        Continue to Investor Analysis ‚Üí
    </button>
</div>
